# 番茄钟应用概要设计文档

## 1. 引言

### 1.1 文档目的
本文档旨在提供番茄钟应用的高层次设计概述，包括系统架构、模块划分、数据模型和主要交互流程，为详细设计和实现提供指导框架。

### 1.2 术语定义
- **前端框架**：React 18.2.0，用于构建用户界面
- **构建工具**：Vite 4.4.5，用于应用构建和开发服务器
- **状态管理**：使用React Context API进行全局状态管理
- **数据存储**：使用浏览器localStorage/IndexedDB进行本地数据持久化
- **组件库**：Lucide-React提供图标支持，自定义组件提供UI元素

## 2. 系统架构

### 2.1 架构概述
番茄钟应用采用现代前端单页应用（SPA）架构，基于React组件化开发模式，使用Context API进行状态管理，通过浏览器本地存储实现数据持久化。

### 2.2 分层架构

![系统架构图](system-architecture.png)

#### 2.2.1 表示层（Presentation Layer）
- 包含所有用户界面组件
- 负责数据展示和用户交互
- 组件采用函数式组件+Hooks模式

#### 2.2.2 业务逻辑层（Business Logic Layer）
- 包含核心业务逻辑处理
- 负责计时、任务管理、数据统计等功能实现
- 通过Context API提供全局状态管理

#### 2.2.3 数据访问层（Data Access Layer）
- 封装数据存储和检索操作
- 提供统一的数据访问接口
- 处理数据格式转换和验证

#### 2.2.4 基础设施层（Infrastructure Layer）
- 提供工具函数、常量定义
- 配置文件和环境设置
- 浏览器API封装

## 3. 模块划分

### 3.1 核心模块

#### 3.1.1 计时器模块（Timer Module）
- **功能**：实现番茄钟、短休息、长休息的计时功能
- **主要组件**：
  - `TimerDisplay`：显示当前计时状态和剩余时间
  - `TimerControls`：提供开始、暂停、重置等控制按钮
  - `TimerService`：处理计时逻辑和状态管理

#### 3.1.2 任务管理模块（Task Management Module）
- **功能**：管理用户任务，包括添加、编辑、删除和标记完成
- **主要组件**：
  - `TaskList`：显示任务列表
  - `TaskForm`：任务添加/编辑表单
  - `TaskItem`：单个任务项组件
  - `TaskService`：任务数据管理服务

#### 3.1.3 统计分析模块（Statistics Module）
- **功能**：收集和展示用户的番茄钟统计数据
- **主要组件**：
  - `StatisticsDashboard`：统计数据总览
  - `Charts`：各类数据可视化图表
  - `StatisticsService`：数据统计和分析服务

#### 3.1.4 设置模块（Settings Module）
- **功能**：管理应用配置和用户偏好设置
- **主要组件**：
  - `SettingsPanel`：设置面板
  - `SettingsForm`：设置表单
  - `SettingsService`：设置数据管理服务

### 3.2 共享模块

#### 3.2.1 UI组件库（UI Components）
- **功能**：提供可复用的UI组件
- **主要组件**：
  - `Button`：自定义按钮组件
  - `Modal`：模态框组件
  - `Dropdown`：下拉菜单组件
  - `ProgressBar`：进度条组件
  - `ToggleSwitch`：开关组件

#### 3.2.2 服务层（Services）
- **功能**：提供跨模块的公共服务
- **主要服务**：
  - `StorageService`：本地存储服务
  - `NotificationService`：通知和提醒服务
  - `SoundService`：音频播放服务
  - `ThemeService`：主题管理服务

#### 3.2.3 工具模块（Utilities）
- **功能**：提供通用工具函数
- **主要功能**：
  - 日期时间处理
  - 数据格式转换
  - 验证函数
  - 常量定义

## 4. 数据模型设计

### 4.1 数据实体

#### 4.1.1 任务（Task）
```typescript
interface Task {
  id: string;             // UUID
  name: string;           // 任务名称
  description?: string;   // 任务描述（可选）
  category?: string;      // 任务类别（可选）
  estimatedPomodoros: number; // 预计番茄钟数量
  completedPomodoros: number; // 已完成番茄钟数量
  isCompleted: boolean;   // 是否完成
  createdAt: Date;        // 创建时间
  updatedAt: Date;        // 更新时间
}
```

#### 4.1.2 番茄钟记录（PomodoroRecord）
```typescript
interface PomodoroRecord {
  id: string;             // UUID
  taskId?: string;        // 关联任务ID（可选）
  startTime: Date;        // 开始时间
  endTime: Date;          // 结束时间
  duration: number;       // 持续时间（分钟）
  type: 'pomodoro' | 'short-break' | 'long-break'; // 类型
  completed: boolean;     // 是否完成
  interruptions: number;  // 中断次数
}
```

#### 4.1.3 用户设置（UserSettings）
```typescript
interface UserSettings {
  timer: {
    pomodoroDuration: number;      // 番茄钟时长（分钟）
    shortBreakDuration: number;    // 短休息时长（分钟）
    longBreakDuration: number;     // 长休息时长（分钟）
    longBreakInterval: number;     // 长休息间隔（番茄钟数量）
  };
  notifications: {
    soundEnabled: boolean;         // 是否启用声音
    volume: number;                // 音量（0-100）
    soundType: string;             // 音效类型
    visualNotification: boolean;   // 是否启用视觉通知
  };
  appearance: {
    theme: 'light' | 'dark' | 'system'; // 主题
    fontSize: 'small' | 'medium' | 'large'; // 字体大小
  };
  language: string;                // 语言设置
}
```

### 4.2 数据存储方案

#### 4.2.1 本地存储策略
- **存储方式**：主要使用localStorage存储设置和任务数据
- **历史数据**：使用IndexedDB存储大量的历史记录数据
- **数据加密**：敏感数据使用简单加密存储（如需要）
- **数据备份**：提供手动导出/导入功能

#### 4.2.2 数据访问接口
```typescript
// 任务数据访问接口
interface TaskRepository {
  getAll: () => Promise<Task[]>;
  getById: (id: string) => Promise<Task | null>;
  create: (task: Omit<Task, 'id' | 'createdAt' | 'updatedAt'>) => Promise<Task>;
  update: (task: Task) => Promise<Task>;
  delete: (id: string) => Promise<void>;
}

// 番茄钟记录数据访问接口
interface PomodoroRepository {
  getAll: () => Promise<PomodoroRecord[]>;
  getByDateRange: (start: Date, end: Date) => Promise<PomodoroRecord[]>;
  create: (record: Omit<PomodoroRecord, 'id'>) => Promise<PomodoroRecord>;
  getStats: (period: 'day' | 'week' | 'month') => Promise<StatisticsData>;
}

// 设置数据访问接口
interface SettingsRepository {
  get: () => Promise<UserSettings>;
  update: (settings: Partial<UserSettings>) => Promise<UserSettings>;
  reset: () => Promise<UserSettings>;
}
```

## 5. 界面设计

### 5.1 界面结构

#### 5.1.1 主界面布局
- **顶部导航栏**：应用标题、设置入口、统计入口
- **主内容区**：
  - 大型计时器显示
  - 任务列表/详情
  - 控制按钮
- **底部状态栏**：显示当前任务信息、今日完成统计

#### 5.1.2 主要页面
- **主计时器页面**：核心计时功能和当前任务
- **任务管理页面**：完整的任务列表和管理功能
- **统计分析页面**：各类统计图表和数据分析
- **设置页面**：应用配置和个性化设置

### 5.2 交互流程

#### 5.2.1 核心交互流程
1. 用户启动应用，进入主计时器页面
2. 选择或创建任务
3. 点击开始按钮启动番茄钟
4. 番茄钟计时结束，播放提醒音，自动进入休息模式
5. 休息结束，提醒用户，准备下一个番茄钟
6. 用户可以随时暂停、继续或重置计时器

#### 5.2.2 任务管理流程
1. 用户进入任务管理页面
2. 查看现有任务列表
3. 可以添加新任务、编辑或删除现有任务
4. 可以将任务标记为完成
5. 任务状态实时更新

## 6. 状态管理设计

### 6.1 状态管理架构
- 使用React Context API创建全局状态管理
- 采用reducer模式处理复杂状态更新
- 状态按功能模块进行划分

### 6.2 主要状态模块

#### 6.2.1 计时器状态（TimerState）
```typescript
interface TimerState {
  status: 'idle' | 'running' | 'paused' | 'completed';
  currentMode: 'pomodoro' | 'short-break' | 'long-break';
  timeRemaining: number; // 剩余时间（秒）
  totalDuration: number; // 总时长（秒）
  completedPomodoros: number; // 当前会话已完成番茄钟数量
  activeTaskId?: string; // 当前活动任务ID
}
```

#### 6.2.2 任务状态（TasksState）
```typescript
interface TasksState {
  tasks: Task[];
  loading: boolean;
  error: string | null;
  filter: { category?: string; isCompleted?: boolean };
}
```

#### 6.2.3 设置状态（SettingsState）
```typescript
interface SettingsState {
  settings: UserSettings;
  isLoading: boolean;
  error: string | null;
}
```

## 7. API设计

### 7.1 内部API接口

#### 7.1.1 计时器服务API
```typescript
class TimerService {
  start(mode: 'pomodoro' | 'short-break' | 'long-break', taskId?: string): void;
  pause(): void;
  resume(): void;
  reset(): void;
  skip(): void; // 跳过当前计时周期
  updateSettings(settings: Partial<UserSettings['timer']>): void;
  addListener(callback: (state: TimerState) => void): () => void; // 订阅状态变化
}
```

#### 7.1.2 任务服务API
```typescript
class TaskService {
  getAllTasks(): Promise<Task[]>;
  getTaskById(id: string): Promise<Task | null>;
  createTask(taskData: Omit<Task, 'id' | 'createdAt' | 'updatedAt'>): Promise<Task>;
  updateTask(task: Task): Promise<Task>;
  deleteTask(id: string): Promise<void>;
  toggleTaskCompletion(id: string): Promise<Task>;
  incrementPomodoros(id: string): Promise<Task>;
}
```

#### 7.1.3 统计服务API
```typescript
class StatisticsService {
  getDailyStats(date: Date): Promise<DailyStatistics>;
  getWeeklyStats(date: Date): Promise<WeeklyStatistics>;
  getMonthlyStats(date: Date): Promise<MonthlyStatistics>;
  getTaskStats(): Promise<TaskStatistics>;
  exportData(format: 'csv' | 'json'): Promise<string>;
}
```

### 7.2 浏览器API使用
- **localStorage/IndexedDB**：数据持久化存储
- **Audio API**：播放提醒音效
- **Notification API**：发送桌面通知
- **Web Workers**：在后台进行计时，不受UI线程阻塞影响
- **ResizeObserver**：响应式布局调整

## 8. 性能优化策略

### 8.1 前端性能优化
- **代码分割**：使用React.lazy和Suspense实现组件懒加载
- **状态管理优化**：避免不必要的重渲染，使用useMemo和useCallback
- **图片和资源优化**：使用适当大小的图标，避免不必要的资源加载
- **事件防抖/节流**：对频繁触发的事件进行优化

### 8.2 存储性能优化
- **数据压缩**：对历史数据进行压缩存储
- **定期清理**：提供旧数据清理机制
- **增量更新**：避免全量数据读写

## 9. 部署与集成

### 9.1 构建流程
- 使用Vite进行应用构建
- 配置环境变量区分开发和生产环境
- 自动生成资源哈希，支持长期缓存

### 9.2 部署策略
- 构建产物为静态文件，可部署到任何静态网站托管服务
- 支持PWA（Progressive Web App），实现离线访问
- 推荐部署服务：Netlify、Vercel、GitHub Pages等

## 10. 扩展与维护

### 10.1 可扩展性设计
- 模块化架构，便于功能扩展
- 统一的接口设计，降低模块间耦合
- 支持插件机制，允许功能扩展

### 10.2 维护策略
- 完善的日志记录机制
- 错误边界处理，避免应用崩溃
- 数据备份和恢复机制

---

**文档版本**：V1.0.0  
**创建日期**：2024年1月  
**更新日期**：2024年1月